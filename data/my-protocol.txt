-----------------------------------
Analysis with MSSM update datacards
-----------------------------------

test data samples: 150123 ---> 0.025pb m=500; 2.5pb m=120
model mhmodp samples: 150127
model mhmodp samples 120 ONLY: 150206
model mhmodp samples 500 ONLY: 150207
SM vs MSSM samples: 150209
model mhmodp with NLL: 
-----------------
Injecting signals:


python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM_taupt.py -a bbb --label='-150127-mssm-taupt' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-141121-mssm-taupt.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-taupt-150122" --update-all --blind-datacards --extra-templates='0.007354608*ggH500, 1.166089265*ggH120, 0.080838097*bbH500, 0.016368334*bbH120'

-----------------
test for injecting datacards:
python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM_taupt.py -a bbb --label='-150123-mssm-taupt-TEST' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-141121-mssm-taupt.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-taupt-150123" --update-all --blind-datacards --extra-templates='1.5*ggH120, 0.02*bbH120'

------------------
SM vs. MSSM injecting signals:

python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM_taupt.py -a bbb --label='-150209-mssm-taupt' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-141121-mssm-taupt.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-taupt-150122" --update-all --blind-datacards --SMHasBackground --SMHasSignal --extra-templates='0.007354608*ggH500, 1.166089265*ggH120, 0.080838097*bbH500, 0.016368334*bbH120'

------------------
SM vs. MSSM tanb vs m_A:

lxb-xsec2tanb.py LIMITS-150209-mssm-taupt/bbb-MSSMvsSM-asimov-mhmodp/cmb/* --MSSMvsSM  --model mhmodp --lxq

submit.py --HypothesisTest --cycles 51-100 --toys 200 LIMITS-150209-mssm-taupt/bbb-MSSMvsSM-asimov-mhmodp/cmb/* --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null" --options="--userOpt '-v -1  > /dev/null'"

submit.py --HypothesisTest --collect LIMITS-150209-mssm-taupt/bbb-MSSMvsSM-asimov-mhmodp/cmb/* --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null" --options=''

plot --tanb HiggsAnalysis/HiggsToTauTau/python/layouts/hypo-test-mhmodp.py LIMITS-150209-mssm-taupt/bbb-MSSMvsSM-asimov-mhmodp/cmb



tanb=30, m_A=500, mhmodp -> m_H=500 , m_h=120 
-----------------
Xs and BR calculation for these parameters
root -l -b -q 'HiggsAnalysis/HiggsToTauTau/macros/mssm_xs.C("$CMSSW_BASE/src/auxiliaries/models/out.mhmodp-8TeV-tanbHigh-nnlo.root", 500, 30)'

-----------------
crosssection*BR in pb 
Xs*Br(ggA->TauTau) = 4.07339752679999976e-03 = 0.004073398
Xs*Br(ggH->TauTau) = 3.28121001949999982e-03 = 0.003281210 --> sum of heavy Higgses: 7.35460754629999915e-03 = 0.007354608
Xs*Br(ggh->TauTau) = 1.16608926489999987e+00 = 1.166089265
Xs*Br(bbA->TauTau) = 4.44335636639999962e-02 = 0.044433564
Xs*Br(bbH->TauTau) = 4.36045331399999986e-02 = 0.043604533 --> sum of heavy Higgses: 8.80380968039999878e-02 = 0.080838097
Xs*Br(bbh->TauTau) = 1.63683335438000004e-02 = 0.016368334  
-----------------
boundaries 

m=120: ggH: 2.5, bbH: 0.04
m=500: ggH: 0.02, bbH: 0.2 

-----------------
multidim-fit:

cvs2local.py -i aux-150127-mssm-taupt/bbb-asimov -o LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH -p 8TeV -a mssm -c 'mt et em mm tt' --mssm-categories-mt="10 11 12 13 14" --mssm-categories-tt="10 11 12 13 14" --mssm-categories-et="10 11 12 13 14" 90 130 100_200:20 250_500:50 600_1000:100

Zoomed for 90-120-130-140, 400-450-500-600 ---> adjust mssm multidim fit boundaries!!!
submit.py --multidim-fit --stable --physics-model='ggH-bbH' LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/120 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/130 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/500 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/90 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/140 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/450 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/400 LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/600 --lxq --queue="-l h_vmem=2000M -l h_rt=12:00:00 -j y -o /dev/null"

-----------------
multidim-fit resubmission
python HiggsAnalysis/HiggsToTauTau/python/lxb-multidimfit-resubmit.py LIMITS-150127-mssm-taupt-bbb-asimov-ggH-bbH-GGH-BBH-120 -o LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/ -m '90,120,130,140,400,450,500,600'

-----------------
multidim-fit plotting

limit.py --collect --multidim-fit --physics-model="ggH-bbH" LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH/*

plot --multidim-fit HiggsAnalysis/HiggsToTauTau/python/layouts/multidim-fit-ggH-bbH.py LIMITS-150127-mssm-taupt/bbb-asimov-ggH-bbH

------------------
tanb vs m_A for combined 8TeV:

setup-htt.py -i aux-150127-mssm-taupt/bbb-asimov -o LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp -a mssm -c 'mt et em mm tt' -p 8TeV --mssm-categories-mt="10 11 12 13 14" --mssm-categories-tt="10 11 12 13 14" --mssm-categories-et="10 11 12 13 14" 90 130 100_200:20 250_500:50 600_1000:100

Need here 4h and 4000MB for a job!!!
lxb-xsec2tanb.py LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp/cmb/* --model mhmodp --lxq

submit.py --tanb+  LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp/cmb/* --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null" --options='--multi-core=4'

plot --tanb HiggsAnalysis/HiggsToTauTau/python/layouts/tanb-mhmodp.py LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp/cmb

--------------------
tanb vs m_A for combined 8TeV FULL NLL: 

setup-htt.py -i aux-150127-mssm-taupt/bbb-asimov -o LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL -a mssm -c 'mt et em mm tt' -p 8TeV --mssm-categories-mt="10 11 12 13 14" --mssm-categories-tt="10 11 12 13 14" --mssm-categories-et="10 11 12 13 14" 90 130 100_200:20 250_500:50 600_1000:100

Need here 4h and 4000MB for a job!!!
lxb-xsec2tanb.py LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/* --model mhmodp --lxq --fineGrid

submit.py --tanbNLL  LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/*0 --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null"

hadd LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/NLLHistogramFull.root LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*/NLLHistogram*.root

clean up:

rm LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*0/higgsCombine*.root LIMITS-150127-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*0/NLLHistogram*.root



-----------------------(mA,tanb)=(900,30)----(mhmodp)--------------------------------------------------------
Xs & BR calculation (mA,tanb)=(900,30):
----------------
root -l
.x HiggsAnalysis/HiggsToTauTau/macros/mssm_xs.C("$CMSSW_BASE/src/auxiliaries/models/out.mhmodp-8TeV-tanbHigh-nnlo.root", 500, 30)

output:


MSSM Cross Section [ggH](tautau) (pb):
 -> xsec(ggA)(tautau):  0.000812921      ---    0.0789586        at mass: 900
 -> xsec(ggH)(tautau):  0.000410751      ---    0.079656         at mass: 899.785
 -> xsec(ggh)(tautau):  17.6056  ---    0.0625216        at mass: 126.014
 -> xsec(cmb)(tautau):  1.10083
MSSM Cross Section [bbH -Santander-](tautau) (pb):
 -> xsec(bbA)(tautau):  0.0161615        ---    0.0789586
 -> xsec(bbH)(tautau):  0.0160298        ---    0.079656
 -> xsec(bbh)(tautau):  0.212571         ---    0.0625216
 -> xsec(cmb)(tautau):  0.0158432

xsec*BR for 900 signal (ggH): 0.0000969059
xsec*BR for 900 signal (bbH): 0.0025529529

xsec*BR for 120 signal (ggH): 1.1007300507
xsec*Br for 120 signal (bbH): 0.0132902775

injection of signals:
--------------------------
python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM_taupt.py -a bbb --label='-150417-mssm-taupt' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-141121-mssm-taupt.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-taupt-150417" --update-all --blind-datacards --extra-templates='0.0000969059*ggH900, 1.1007300507*ggH120, 0.0025529529*bbH900, 0.0132902775*bbH120'

---mA tanb NLL------
setup-htt.py -i aux-150417-mssm-taupt/bbb-asimov -o LIMITS-150417-mssm-taupt/bbb-asimov-mhmodp-NLL -a mssm -c 'mt' -p 8TeV --mssm-categories-mt="10 11 12 13 14" 90 130 100_200:20 250_500:50 600_1000:100

lxb-xsec2tanb.py LIMITS-150417-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/* --model mhmodp --lxq --fineGrid

submit.py --tanbNLL  LIMITS-150417-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*0 --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null"

rm LIMITS-150417-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*0/higgsCombine*.root LIMITS-150417-mssm-taupt/bbb-asimov-mhmodp-NLL/cmb/*0/NLLHistogram*.root


-----------------------------------
Analysis with former MSSM datacards
-----------------------------------

---------
standard (900,30):
---------
python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM.py -a bbb --label='150421-mssm-taupt' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-131013-mssm.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-131013-v2" --update-all --blind-datacards --extra-templates='0.0000969059*ggH900, 1.1007300507*ggH120, 0.0025529529*bbH900, 0.0132902775*bbH120' --fine-scan

mA vs. tanb NLL:
----------------
setup-htt.py -i aux150421-mssm-taupt/bbb-asimov -o LIMITS150421-mssm-taupt/bbb-asimov-mhmodp-NLL -a mssm -c 'mt' -p 8TeV --mssm-categories-mt="8 9" 90_250:10 125 275_500:25 550_1000:50

lxb-xsec2tanb.py LIMITS150421-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/* --model mhmodp --lxq --fineGrid

submit.py --tanbNLL  LIMITS150421-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/* --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null"

rm LIMITS150421-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/*/higgsCombine*.root LIMITS150421-mssm-taupt/bbb-asimov-mhmodp-NLL/mt/*/NLLHistogram*.root

---------
(500,30):
---------
python HiggsAnalysis/HiggsToTauTau/scripts/doMSSM.py -a bbb --label='150428-mssm' --tail-fitting --drop-list="$PWD/auxiliaries/pruning/uncertainty-pruning-drop-131013-mssm.txt" --config="HiggsAnalysis/HiggsToTauTau/data/limits.config-mssm-150425" --update-all --blind-datacards --extra-templates='0.007354608*ggH500, 1.166089265*ggH120, 0.080838097*bbH500, 0.016368334*bbH120' --fine-scan

mA vs. tanb NLL (q_mu = Fit von L zu r=fixed zum Punkt (m_A, tanb)/ Global Fit von L zum Punkt (m_A, tanb)):
----------------
setup-htt.py -i aux150428-mssm/bbb-asimov -o LIMITS150428-mssm/bbb-asimov-mhmodp-NLL -a mssm -c 'mt' -p 8TeV --mssm-categories-mt="8 9" 90_1000:10

lxb-xsec2tanb.py LIMITS150428-mssm/bbb-asimov-mhmodp-NLL/mt/* --model mhmodp --lxq --fineGrid

submit.py --tanbNLL  LIMITS150428-mssm/bbb-asimov-mhmodp-NLL/mt/* --lxq --queue="-l h_vmem=4000M -l h_rt=48:00:00 -j y -o /dev/null"

rm LIMITS150428-mssm/bbb-asimov-mhmodp-NLL/mt/*/higgsCombine*.root LIMITS150428-mssm/bbb-asimov-mhmodp-NLL/mt/*/NLLHistogram*.root


NLL aus modelunabh채ngigen Plots. Vorgehensweise:

1. Crosssections x BR berechnen f체r die gesamte (m_A, tanb)-Ebene (sowohl ggH als auch bbH) --> 2 Histogramme
2. 2D Fit f체r ggH-bbH (modelunabh채ngig): Scan der gesamten Loglikelihood (DeltaNLL + Best Fit). --> 1 Histogramm/Masse
3. Crosssections x BR aus 1. "ersetzen" durch NLL-Werte aus 2. --> 1 Histogramm


multidimfit (directory setup):
------------------------------
cvs2local.py -i aux150428-mssm/bbb-asimov -o LIMITS150428-mssm/bbb-asimov-ggH-bbH -p 8TeV -a mssm -c 'mt' --mssm-categories-mt="8 9" 90_1000:10

multidimfit (calculation):
--------------------------
submit.py --multidim-fit --stable --physics-model='ggH-bbH' LIMITS150428-mssm/bbb-asimov-ggH-bbH/* --lxq --queue="-l h_vmem=2000M -l h_rt=12:00:00 -j y -o /dev/null"

multidimfit (resubmission):
---------------------------
python HiggsAnalysis/HiggsToTauTau/python/lxb-multidimfit-resubmit.py LIMITS150428-mssm-bbb-asimov-ggH-bbH-GGH-BBH-90 -o LIMITS150428-mssm/bbb-asimov-ggH-bbH/ -m '90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710, 720, 730, 740, 750, 760, 770, 780, 790, 800, 810, 820, 830, 840, 850, 860, 870, 880, 890, 900, 910, 920, 930, 940, 950, 960, 970, 980, 990, 1000'


multidimfit (collection):
-------------------------
limit.py --collect --multidim-fit --physics-model="ggH-bbH" LIMITS150428-mssm/bbb-asimov-ggH-bbH/*

multidimfit (plotting):
-----------------------

plot --multidim-fit HiggsAnalysis/HiggsToTauTau/python/layouts/multidim-fit-ggH-bbH.py LIMITS150428-mssm/bbb-asimov-ggH-bbH

combine command:

combine -M MultiDimFit -m 500 --algo=grid -n RL04NI4F22 --cl 0.95 --points 40000 --firstPoint 1 --lastPoint 800    --minimizerStrategy=0 --minimizerTolerance=0.1 --cminPreScan --cminFallbackAlgo "Minuit2,0:1.0" --cminFallbackAlgo "Minuit2,0:10.0" --cminFallbackAlgo "Minuit2,0:50.0" ./ggH-bbH.root